- hosts: all
  tasks:
    - name: Copy Hydrophone results to output folder
      copy:
        src: "{{ zuul.project.src_dir }}/hydrophone-results.tar.gz"
        dest: "{{ zuul_output_dir }}/artifacts/hydrophone-results.tar.gz"
        remote_src: true
      ignore_errors: true

    - name: Return built artifacts to Zuul
      zuul_return:
        data:
          zuul:
            artifacts:
              - name: "Hydrophone Results"
                url: "artifacts/hydrophone-results.tar.gz"
                metadata:
                  type: tarball

    - name: Gather all pod logs from KinD
      become: true
      ignore_errors: true
      block:
        - name: Get the Docker volume ID
          ansible.builtin.command: docker volume ls -q
          register: volume_id

        - name: Copy all of the pod logs
          ansible.builtin.copy:
            src: "/var/lib/docker/volumes/{{ volume_id.stdout_lines[0] }}/_data/log/pods"
            dest: "{{ zuul_output_dir }}/logs"
            owner: "{{ ansible_user }}"
            group: "{{ ansible_user }}"
            remote_src: true
