
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
        <link rel="next" href="../configs/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.15">
    
    
      
        <title>Getting Started - Cluster API driver for Magnum</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.26e3688c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#getting-started" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Cluster API driver for Magnum" class="md-header__button md-logo" aria-label="Cluster API driver for Magnum" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cluster API driver for Magnum
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Getting Started
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Cluster API driver for Magnum" class="md-nav__button md-logo" aria-label="Cluster API driver for Magnum" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Cluster API driver for Magnum
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          User Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          User Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Getting Started
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cluster-operations" class="md-nav__link">
    Cluster Operations
  </a>
  
    <nav class="md-nav" aria-label="Cluster Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating" class="md-nav__link">
    Creating
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accessing" class="md-nav__link">
    Accessing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upgrading" class="md-nav__link">
    Upgrading
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node-group-role" class="md-nav__link">
    Node group role
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference" class="md-nav__link">
    Reference
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configs/" class="md-nav__link">
        Configuration Options
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../images/" class="md-nav__link">
        Images
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../labels/" class="md-nav__link">
        Labels
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Administrator Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Administrator Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Developer Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Developer Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/cluster-topology/" class="md-nav__link">
        Cluster Topology
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/testing-and-development/" class="md-nav__link">
        Testing & Development
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/upgrade-in-atmosphere/" class="md-nav__link">
        Upgrading in Atmosphere environment
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cluster-operations" class="md-nav__link">
    Cluster Operations
  </a>
  
    <nav class="md-nav" aria-label="Cluster Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating" class="md-nav__link">
    Creating
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accessing" class="md-nav__link">
    Accessing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upgrading" class="md-nav__link">
    Upgrading
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node-group-role" class="md-nav__link">
    Node group role
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference" class="md-nav__link">
    Reference
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="getting-started">Getting Started</h1>
<h2 id="cluster-operations">Cluster Operations</h2>
<h3 id="creating">Creating</h3>
<p>You can use a few different methods to create a Kubernetes cluster with the
Cluster API driver for Magnum.  We cover a few different methods in this
section.</p>
<div class="admonition note">
<p class="admonition-title">Notes about deployment speed</p>
<p>The Cluster API driver for Magnum is designed to be fast.  It is capable of
deploying a Kubernetes cluster in under 5 minutes.  However, there are several
factors that can slow down the deployment process:</p>
<ul>
<li>
<p><strong>Operating system image size</strong>
  The average size of the operating system image is around 4 GB.  The image
  needs to be downloaded to each node before deploying the cluster, and the
  download speed depends on the network connection. The compute service caches
  images locally, so the initial cluster deployment is slower than subsequent
  deployments.</p>
</li>
<li>
<p><strong>Network connectivity</strong>
  When the cluster goes up, it needs to pull all the container images from the
  container registry.  By default, it will pull all the images from the upstream
  registries.  If you have a slow network connection, you can use a local
  registry to speed up the deployment process and read more about pointing to
  it in the <a href="../labels/#images">Labels</a> section.</p>
</li>
</ul>
<p><a href="https://github.com/vexxhost/atmosphere">Atmosphere</a> deploys a local
registry by default as well as includes several speed optimizations to
improve the deployment speed down to 5 minutes.</p>
</div>
<p>You can create clusters using several different methods which all end up using
the Magnum API.  You can either use the OpenStack CLI, OpenStack Horizon
dashboard, Terraform, Ansible or the Magnum API directly.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">OpenStack CLI</label><label for="__tabbed_1_2">OpenStack Horizon</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>The OpenStack CLI is the easiest way to create a Kubernetes cluster from
your terminal directly.  You can use the <code>openstack coe cluster create</code>
command to create a Kubernetes cluster with the Cluster API driver for Magnum.</p>
<p>Before you get started, you'll have to make sure that you have the cluster
templates you want to use available in your environment.  You can create
them using the OpenStack CLI:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">OS_DISTRO</span><span class="o">=</span>ubuntu<span class="w"> </span><span class="c1"># you can change this to &quot;flatcar&quot; if you want to use Flatcar</span>
<span class="k">for</span><span class="w"> </span>version<span class="w"> </span><span class="k">in</span><span class="w"> </span>v1.24.16<span class="w"> </span>v1.25.12<span class="w"> </span>v1.26.7<span class="w"> </span>v1.27.4<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">OS_DISTRO</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;ubuntu&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">IMAGE_NAME</span><span class="o">=</span><span class="s2">&quot;ubuntu-2204-kube-</span><span class="si">${</span><span class="nv">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nv">IMAGE_NAME</span><span class="o">=</span><span class="s2">&quot;flatcar-kube-</span><span class="si">${</span><span class="nv">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>curl<span class="w"> </span>-LO<span class="w"> </span>https://object-storage.public.mtl1.vexxhost.net/swift/v1/a91f106f55e64246babde7402c21b87a/magnum-capi/<span class="si">${</span><span class="nv">IMAGE_NAME</span><span class="si">}</span>.qcow2<span class="p">;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>openstack<span class="w"> </span>image<span class="w"> </span>create<span class="w"> </span><span class="si">${</span><span class="nv">IMAGE_NAME</span><span class="si">}</span><span class="w"> </span>--disk-format<span class="o">=</span>qcow2<span class="w"> </span>--container-format<span class="o">=</span>bare<span class="w"> </span>--property<span class="w"> </span><span class="nv">os_distro</span><span class="o">=</span><span class="si">${</span><span class="nv">OS_DISTRO</span><span class="si">}</span><span class="w"> </span>--file<span class="o">=</span><span class="si">${</span><span class="nv">IMAGE_NAME</span><span class="si">}</span>.qcow2<span class="p">;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>openstack<span class="w"> </span>coe<span class="w"> </span>cluster<span class="w"> </span>template<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--image<span class="w"> </span><span class="k">$(</span>openstack<span class="w"> </span>image<span class="w"> </span>show<span class="w"> </span><span class="si">${</span><span class="nv">IMAGE_NAME</span><span class="si">}</span><span class="w"> </span>-c<span class="w"> </span>id<span class="w"> </span>-f<span class="w"> </span>value<span class="k">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--external-network<span class="w"> </span>public<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--dns-nameserver<span class="w"> </span><span class="m">8</span>.8.8.8<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--master-lb-enabled<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--master-flavor<span class="w"> </span>m1.medium<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--flavor<span class="w"> </span>m1.medium<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--network-driver<span class="w"> </span>calico<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--docker-storage-driver<span class="w"> </span>overlay2<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--coe<span class="w"> </span>kubernetes<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--label<span class="w"> </span><span class="nv">kube_tag</span><span class="o">=</span><span class="si">${</span><span class="nv">version</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">      </span>k8s-<span class="si">${</span><span class="nv">version</span><span class="si">}</span><span class="p">;</span>
<span class="k">done</span><span class="p">;</span>
</code></pre></div>
<p>Once you've got a cluster template, you can create a cluster using the
OpenStack CLI:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>openstack<span class="w"> </span>coe<span class="w"> </span>cluster<span class="w"> </span>create<span class="w"> </span>--cluster-template<span class="w"> </span>&lt;cluster-template-name&gt;<span class="w"> </span>&lt;cluster-name&gt;
</code></pre></div>
<p>You'll be able to view the status of the deployment using the OpenStack CLI:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>openstack<span class="w"> </span>coe<span class="w"> </span>cluster<span class="w"> </span>show<span class="w"> </span>&lt;cluster-name&gt;
</code></pre></div>
</div>
<div class="tabbed-block">
<p>The OpenStack Horizon dashboard is the easiest way to create a Kubernetes
using a simple web interface.  In order to get started, you can review the
list of current cluster templates in your environment by navigating using
the left sidebar to <em>Project</em> &gt; <em>Container Infra</em> &gt; <em>Cluster Templates</em>.</p>
<p><img alt="Cluster template list" src="../../static/user/getting-started/cluster-template-list.png" /></p>
<p>In order to launch an new cluster, you will need to navigate to <em>Project</em> &gt;
<em>Container Infra</em> &gt; <em>Clusters</em> and click on the <em>Launch Cluster</em> button.</p>
<p><img alt="Cluster list with create button" src="../../static/user/getting-started/cluster-list-create.png" /></p>
<p>There is a set of required fields that you will need to fill out in order
to launch a cluster, the first of which are related to it's basic
configuration, the required fields are:</p>
<ul>
<li>
<p><strong>Cluster Name</strong>
  The name of the cluster that will be created.</p>
</li>
<li>
<p><strong>Cluster Template</strong>
  The cluster template that will be used to create the cluster.</p>
</li>
<li>
<p><strong>Keypair</strong>
  The SSH key pair that will be used to access the cluster.</p>
</li>
</ul>
<p>In this example, we're going to create a cluster with the name of
<code>test-cluster</code>, running Kuberentes 1.27.3 so using the <code>k8s-v1.27.3</code>
cluster template, and using the <code>admin_key</code> SSH key pair.</p>
<p><img alt="Cluster create information" src="../../static/user/getting-started/cluster-create-info.png" /></p>
<p>The next step is deciding on the size of the cluster and selecting if auto
scaling will be enabled for the cluster.  The required fields are:</p>
<ul>
<li>
<p><strong>Number of Master Nodes</strong>
  The number of master nodes that will be created in the cluster.</p>
</li>
<li>
<p><strong>Flavor of Master Nodes</strong>
  The flavor of the master nodes that will be created in the cluster.</p>
</li>
<li>
<p><strong>Number of Worker Nodes</strong>
  The number of worker nodes that will be created in the cluster.</p>
</li>
<li>
<p><strong>Flavor of Worker Nodes</strong>
  The flavor of the worker nodes that will be created in the cluster.</p>
</li>
</ul>
<p>In addition, if you want to enable auto scaling, you will need to provide the
following information:</p>
<ul>
<li>
<p><strong>Auto-scale Worker Nodes</strong>
  Whether or not to enable auto scaling for the worker nodes.</p>
</li>
<li>
<p><strong>Minimum Number of Worker Nodes</strong>
  The minimum number of worker nodes that will be created in the cluster,
  the auto scaler will not scale below this number even if the cluster is
  under utilized.</p>
</li>
<li>
<p><strong>Maximum Number of Worker Nodes</strong>
  The maximum number of worker nodes that will be created in the cluster,
  the auto scaler will not scale above this number even if the cluster is
  over utilized.</p>
</li>
</ul>
<p>In this example, we're going to create a cluster with 3 master node and 4
worker nodes, using the <code>m1.medium</code> flavor for both the master and worker
nodes, and we will enable auto scaling with a minimum of 2 worker nodes and
a maximum of 10 worker nodes.</p>
<p><img alt="Cluster create size" src="../../static/user/getting-started/cluster-create-size.png" /></p>
<p>The next step is managing the network configuration of the cluster.  The
required fields are:</p>
<ul>
<li>
<p><strong>Enable Load Balancer for Master Nodes</strong>
  This is required to be <strong>enabled</strong> for the Cluster API driver for Magnum
  to work properly.</p>
</li>
<li>
<p><strong>Create New Network</strong>
  This will determine if a new network will be created for the cluster or if
  an existing network will be used.  It's useful to use an existing network
  if you want to attach the cluster to an existing network with other
  resources.</p>
</li>
<li>
<p><strong>Cluster API</strong>
  This setting controls if the API will get a floating IP address assigned
  to it.  You can set this to <em>Accessible on private network only</em> if you
  are using an existing network and don't want to expose the API to the
  public internet. Otherwise, you should set it to <em>Accessible on the public
  internet</em> to allow access to the API from the external network.</p>
</li>
</ul>
<p>In this example, we're going to make sure we have the load balancer enabled
for the master nodes, we're going to create a new network for the cluster,
and we're going to make sure that the API is accessible on the public internet.</p>
<p><img alt="Cluster create network" src="../../static/user/getting-started/cluster-create-network.png" /></p>
<p>For the next step, we need to decide if we want to enable auto-healing for
the cluster which automatically detects nodes that are unhealthy and
replaces them with new nodes.  The required fields are:</p>
<ul>
<li><strong>Automatically Repair Unhealthy Nodes</strong>
  Whether or not to enable auto-healing for the cluster.</li>
</ul>
<p>In this example, we're going to enable auto-healing for the cluster since it
will help keep the cluster healthy.</p>
<p><img alt="Cluster create management" src="../../static/user/getting-started/cluster-create-mgmt.png" /></p>
<p>Finally, you can override labels for the cluster in the <em>Advanced</em> section,
we do not recommend changing these unless you know what you're doing.  Once
you're ready, you can click on the <em>Submit</em> button to create the cluster.
The page will show your cluster being created.</p>
<p><img alt="Cluster list after creation" src="../../static/user/getting-started/cluster-postcreate-list.png" /></p>
<p>If you click on the cluster, you'll be able to track the progress of the
cluster creation, more specifically in the <em>Status Reason</em> field, seen below:</p>
<p><img alt="Cluster show after creation" src="../../static/user/getting-started/cluster-postcreate-show.png" /></p>
<p>Once the cluster is created, you'll be able to see the cluster details,
including the health status as well:</p>
<p><img alt="Cluster show after creation" src="../../static/user/getting-started/cluster-created-show.png" /></p>
</div>
</div>
</div>
<p>At this point, you should have a ready cluster and you can proceed to the
<a href="#accessing">Accessing</a> section to learn how to access the cluster.</p>
<h3 id="accessing">Accessing</h3>
<p>In order to access the Kubernetes cluster, you will have to request for a
<code>KUBECONFIG</code> file generated by the Cluster API driver for Magnum.  You can do
this using a few several ways, we cover a few of them in this section.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:1"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">OpenStack CLI</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>You can use the OpenStack CLI to request a <code>KUBECONFIG</code> file for a
Kubernetes cluster.  You can do this using the <code>openstack coe cluster config</code>
command:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>openstack<span class="w"> </span>coe<span class="w"> </span>cluster<span class="w"> </span>config<span class="w"> </span>&lt;cluster-name&gt;
</code></pre></div>
</div>
</div>
</div>
<h3 id="upgrading">Upgrading</h3>
<p>The Cluster API driver for Magnum supports upgrading Kubernetes clusters to any
minor release in the same series or one major release ahead.  The upgrade
process is performed in-place, meaning that the existing cluster is upgraded to
the new version without creating a new cluster in a rolling fashion.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You must have an operating system image for the new Kubernetes version
available in Glance before upgrading the cluster.  See the <a href="../images/">Images
documentation</a> for more information.</p>
</div>
<p>In order to upgrade a cluster, you must have a cluster template pointing at the
image for the new Kubernetes version and the <code>kube_tag</code> label must be updated
to point at the new Kubernetes version.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:1"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">OpenStack CLI</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Once you have this cluster template, you can trigger an upgrade by using the
OpenStack CLI:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>openstack<span class="w"> </span>coe<span class="w"> </span>cluster<span class="w"> </span>upgrade<span class="w"> </span>&lt;cluster-name&gt;<span class="w"> </span>&lt;cluster-template-name&gt;
</code></pre></div>
</div>
</div>
</div>
<h3 id="node-group-role">Node group role</h3>
<p>Roles can be used to show the purpose of a node group, and multiple node groups can be given the same role if they share a common purpose.
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>openstack<span class="w"> </span>coe<span class="w"> </span>nodegroup<span class="w"> </span>create<span class="w"> </span>kube<span class="w"> </span>test-ng<span class="w"> </span>--node-count<span class="w"> </span><span class="m">1</span><span class="w"> </span>--role<span class="w"> </span><span class="nb">test</span>
</code></pre></div>
When listing node groups, the role may be used as a filter:
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>openstack<span class="w"> </span>coe<span class="w"> </span>nodegroup<span class="w"> </span>list<span class="w"> </span>kube<span class="w"> </span>--role<span class="w"> </span><span class="nb">test</span>
+--------------------------------------+---------+-----------+--------------------------------------+------------+-----------------+------+
<span class="p">|</span><span class="w"> </span>uuid<span class="w">                                 </span><span class="p">|</span><span class="w"> </span>name<span class="w">    </span><span class="p">|</span><span class="w"> </span>flavor_id<span class="w"> </span><span class="p">|</span><span class="w"> </span>image_id<span class="w">                             </span><span class="p">|</span><span class="w"> </span>node_count<span class="w"> </span><span class="p">|</span><span class="w"> </span>status<span class="w">          </span><span class="p">|</span><span class="w"> </span>role<span class="w"> </span><span class="p">|</span>
+--------------------------------------+---------+-----------+--------------------------------------+------------+-----------------+------+
<span class="p">|</span><span class="w"> </span>c8acbb1f-2fa3-4d1f-b583-9a2df1e269d7<span class="w"> </span><span class="p">|</span><span class="w"> </span>test-ng<span class="w"> </span><span class="p">|</span><span class="w"> </span>m1.medium<span class="w"> </span><span class="p">|</span><span class="w"> </span>ef107f29-8f26-474e-8f5f-80d269c7d2cd<span class="w"> </span><span class="p">|</span><span class="w">          </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>CREATE_COMPLETE<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="p">|</span>
+--------------------------------------+---------+-----------+--------------------------------------+------------+-----------------+------+
</code></pre></div>
The node group role will default to "worker" if unset, and the only reserved role is "master".
Role information is available within Kubernetes.
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>nodes
NAME<span class="w">                                          </span>STATUS<span class="w">   </span>ROLES<span class="w">                  </span>AGE<span class="w">     </span>VERSION
kube-7kjbp-control-plane-vxtrz-nhjr2<span class="w">          </span>Ready<span class="w">    </span>control-plane,master<span class="w">   </span>3d<span class="w">      </span>v1.25.3
kube-7kjbp-default-worker-infra-hnk8x-v6cp9<span class="w">   </span>Ready<span class="w">    </span>worker<span class="w">                 </span>2d19h<span class="w">   </span>v1.25.3
kube-7kjbp-test-ng-infra-b8yux-3v6fd<span class="w">          </span>Ready<span class="w">    </span><span class="nb">test</span><span class="w">                   </span>5m<span class="w">      </span>v1.25.3
</code></pre></div>
This information can be used for scheduling, using a node selector.
<div class="highlight"><pre><span></span><code>nodeSelector:
<span class="w">  </span><span class="c1"># node-role.kubernetes.io/ROLE_NAME: &quot;&quot;</span>
<span class="w">  </span>node-role.kubernetes.io/test:<span class="w"> </span><span class="s2">&quot;&quot;</span>
</code></pre></div>
The label <code>node.cluster.x-k8s.io/nodegroup</code> is also available for selecting a specific node group.
<div class="highlight"><pre><span></span><code>nodeSelector:
<span class="w">  </span><span class="c1"># node.cluster.x-k8s.io/nodegroup: &quot;NODEGROUP_NAME&quot;</span>
<span class="w">  </span>node.cluster.x-k8s.io/nodegroup:<span class="w"> </span><span class="s2">&quot;test-ng&quot;</span>
</code></pre></div></p>
<h2 id="reference">Reference</h2>
<p>Here reference awesome blog:</p>
<ul>
<li><a href="https://satishdotpatel.github.io/kubernetes-cluster-autoscaler-with-magnum-capi/"><code>Kubernetes Cluster Autoscaler with Magnum CAPI Driver</code></a> written by Satish Patel.</li>
</ul>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Cluster API driver for Magnum is a community effort led by <a href="https://vexxhost.com">VEXXHOST, Inc.</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.tabs.link", "navigation.tracking"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.b4d07000.min.js"></script>
      
    
  </body>
</html>